<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Doctors</title>
    <link href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body {
            font-family: 'Roboto', sans-serif;
            background: #ffffff; /* White background */
            color: #000000; /* Black text */
        }
        .navbar-custom {
            background-color: #2a5298; /* Royal Blue */
        }
        .navbar-custom .navbar-brand {
            color: #ffffff;
        }
        .navbar-custom .nav-link {
            color: #ffffff;
            margin-left: 15px;
        }
        .navbar-custom .nav-link:hover {
            color: #dcdcdc;
        }
        .profile-pic {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            border: 2px solid #ffffff; /* White border for profile picture */
            margin-right: 10px;
        }
        .logout-btn {
            background-color: #dc3545; /* Bootstrap's danger color */
            color: #ffffff;
            border: none;
            border-radius: 25px; /* Rounded button */
            padding: 10px 20px;
            font-size: 16px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3); /* Shadow for button */
            transition: background-color 0.3s, box-shadow 0.3s; /* Smooth transitions */
        }
        .logout-btn:hover {
            background-color: #c82333; /* Darker red on hover */
            cursor: pointer;
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.4); /* Darker shadow on hover */
        }
        
        .btn-primary{
            color: #2a5298;
        }
    </style>
</head>
<body>
    {% if user_type == 'doctor' %}
        {% include '_include/header_doctor.html' %}
    {% else %}
        {% include '_include/header_patient.html' %}
    {% endif %}
    <div class="container">
        <h2>List of Doctors</h2>
        <table class="table">
            <thead>
                <tr>
                    <th>Serial Number</th>
                    <th>Doctor Profile</th>
                    <th>Doctor Name</th>
                    <th>Book Appointment</th>
                </tr>
            </thead>
            <tbody>
                {% for doctor in doctors %}
                <tr>
                    <td>{{ forloop.counter }}</td>
                    <td>
                        <img src="{{ doctor.profile_picture.url }}" alt="{{ doctor.get_full_name }}" class="profile-pic">
                    </td>
                    <td>{{ doctor.get_full_name }}</td>
                    <td>
                        <button type="button" class="btn btn-primary" data-toggle="modal" data-target="#bookAppointmentModal" data-doctor-id="{{ doctor.pk }}" data-doctor-name="{{ doctor.get_full_name }}">
                            Book Appointment
                        </button>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>

    <!-- Book Appointment Modal -->
    <div class="modal fade" id="bookAppointmentModal" tabindex="-1" aria-labelledby="bookAppointmentModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="bookAppointmentModalLabel">Book Appointment</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    <form id="bookAppointmentForm">
                        {% csrf_token %}
                        <input type="hidden" id="doctorId" name="doctor_id">
                        <div class="form-group">
                            <label for="speciality">Speciality:</label>
                            <input type="text" id="speciality" name="speciality" class="form-control" required>
                        </div>
                        <div class="form-group">
                            <label for="appointment_date">Date:</label>
                            <input type="date" id="appointment_date" name="appointment_date" class="form-control" required>
                        </div>
                        <div class="form-group">
                            <label for="start_time">Start Time:</label>
                            <input type="time" id="start_time" name="start_time" class="form-control" required>
                        </div>
                        <button type="submit" class="btn btn-primary">Confirm</button>
                    </form>
                    <div id="errorMessage" class="alert alert-danger mt-2" style="display: none;"></div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.9.3/dist/umd/popper.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
    <script>
        $('#bookAppointmentModal').on('show.bs.modal', function (event) {
            var button = $(event.relatedTarget) 
            var doctorId = button.data('doctor-id') 
            var doctorName = button.data('doctor-name')
            var modal = $(this)
            modal.find('.modal-title').text('Book Appointment with Dr. ' + doctorName)
            modal.find('#doctorId').val(doctorId)
        })

        $('#bookAppointmentForm').on('submit', function (event) {
            event.preventDefault()
            var form = $(this)
            var url = "{% url 'book_appointment' 1 %}".replace('1', $('#doctorId').val())  // Update this line

            $.ajax({
                type: 'POST',
                url: url,
                data: form.serialize(),
                success: function (response) {
                    // Handle success response
                    $('#bookAppointmentModal').modal('hide')
                    alert('Appointment booked successfully!')
                    // Optionally, display a success message or refresh the page
                },
                error: function (response) {
                    // Handle error response
                    $('#errorMessage').text(response.responseJSON.error).show()
                }
            })
        })
    </script>
</body>
</html>
